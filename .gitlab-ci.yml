before_script:
  - export LANG=C
  - module load impi/5.1.3 intel/16.0 gcc/4.9 mkl/11.3 autotools pkg-config
  - module list
  - env

# define two stages, that way coverage only runs after all other
# tests have been done.
stages:
  - test
  - coverage

# autogenerated tests

autogenerated-cpu-large-1-50-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 1500 50 16 1 50

autogenerated-cpu-large-51-100-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 1500 50 16 51 100

autogenerated-cpu-large-101-150-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 1500 50 16 101 150

autogenerated-cpu-large-151-200-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 1500 50 16 151 200

autogenerated-cpu-large-251-250-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 1500 50 16 251 250

autogenerated-cpu-large-301-350-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 1500 50 16 301 350

autogenerated-cpu-large-351-400-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 1500 50 16 351 400

autogenerated-cpu-large-451-500-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 1500 50 16 451 500

autogenerated-cpu-large-501-550-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 1500 50 16 501 550

autogenerated-cpu-large-551-600-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 1500 50 16 551 600

autogenerated-cpu-large-601-650-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 1500 50 16 601 650

autogenerated-cpu-large-651-700-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 1500 50 16 651 700

autogenerated-cpu-large-701-750-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 1500 50 16 701 750

autogenerated-cpu-large-751-800-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 1500 50 16 751 800

autogenerated-cpu-large-801-850-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 1500 50 16 801 850

autogenerated-cpu-large-851-900-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 1500 50 16 851 900

autogenerated-cpu-large-901-950-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 1500 50 16 901 950

autogenerated-cpu-large-951-1000-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 1500 50 16 951 1000

autogenerated-cpu-large-1001-1024-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 1500 50 16 951 1024


autogenerated-cpu-small-1-50-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 150 50 16 1 50

autogenerated-cpu-small-51-100-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 150 50 16 51 100

autogenerated-cpu-small-101-150-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 150 50 16 101 150

autogenerated-cpu-small-151-200-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 150 50 16 151 200

autogenerated-cpu-small-251-250-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 150 50 16 251 250

autogenerated-cpu-small-301-350-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 150 50 16 301 350

autogenerated-cpu-small-351-400-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 150 50 16 351 400

autogenerated-cpu-small-451-500-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 150 50 16 451 500

autogenerated-cpu-small-501-550-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 150 50 16 501 550

autogenerated-cpu-small-551-600-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 150 50 16 551 600

autogenerated-cpu-small-601-650-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 150 50 16 601 650

autogenerated-cpu-small-651-700-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 150 50 16 651 700

autogenerated-cpu-small-701-750-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 150 50 16 701 750

autogenerated-cpu-small-751-800-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 150 50 16 751 800

autogenerated-cpu-small-801-850-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 150 50 16 801 850

autogenerated-cpu-small-851-900-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 150 50 16 851 900

autogenerated-cpu-small-901-950-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 150 50 16 901 950

autogenerated-cpu-small-951-1000-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 150 50 16 951 1000

autogenerated-cpu-small-1001-1024-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export PATH=/home/elpa/python-3.6/bin:$PATH
    - ./gitlab_ci_test cpu 150 50 16 951 1024


#
#
#autogenerated-emulated-small-jobs:
#  tags:
#    - emulated
#  script:
#    - ./autogen.sh
#    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
#    - export PATH=/home/elpa/python-3.6/bin:$PATH
#    - ./gitlab_ci_test emulated 150 50 16
#
#autogenerated-gpu-large-jobs:
#  tags:
#    - gpu
#  script:
#    - ./autogen.sh
#    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
#    - export PATH=/home/elpa/python-3.6/bin:$PATH
#    - ./gitlab_ci_test gpu 1500 500 128
#

# print coverage results
total_coverage:
  stage: coverage
  tags:
    - cpu
    - emulated
    - gpu
  script:
    - ./ci_coverage_summary
  artifacts:
    paths:
      - coverage_data


before_script:
  - export LANG=C
  - module load impi/5.1.3 intel/16.0 gcc/4.9 mkl/11.3 autotools pkg-config
  - export MKL_INTEL_SCALAPACK_MPI_NO_OMP_BASELINE="-L$MKL_HOME/lib/intel64 -lmkl_scalapack_lp64 -lmkl_intel_lp64 -lmkl_sequential -lmkl_core -lmkl_blacs_intelmpi_lp64 -lpthread -lm"
  - export MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP="$MKL_INTEL_SCALAPACK_MPI_NO_OMP_BASELINE -I$MKL_HOME/include/intel64/lp64"
  - export MKL_INTEL_SCALAPACK_LDFLAGS_MPI_NO_OMP="$MKL_INTEL_SCALAPACK_MPI_NO_OMP_BASELINE -Wl,-rpath,$MKL_HOME/lib/intel64"

  - export MKL_INTEL_SCALAPACK_MPI_OMP_BASELINE="-L$MKL_HOME/lib/intel64 -lmkl_scalapack_lp64 -lmkl_intel_lp64 -lmkl_sequential -lmkl_core -lmkl_blacs_intelmpi_lp64 -lpthread -lm"
  - export MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP="$MKL_INTEL_SCALAPACK_MPI_OMP_BASELINE -I$MKL_HOME/include/intel64/lp64"
  - export MKL_INTEL_SCALAPACK_LDFLAGS_MPI_OMP="$MKL_INTEL_SCALAPACK_MPI_OMP_BASELINE -Wl,-rpath,$MKL_HOME/lib/intel64"

  - export MKL_INTEL_SCALAPACK_NO_MPI_NO_OMP_BASELINE="-L$MKL_HOME/lib/intel64 -lmkl_intel_lp64 -lmkl_sequential -lmkl_core -lpthread -lm"
  - export MKL_INTEL_SCALAPACK_FCFLAGS_NO_MPI_NO_OMP="$MKL_INTEL_SCALAPACK_NO_MPI_NO_OMP_BASELINE -I$MKL_HOME/include/intel64/lp64"
  - export MKL_INTEL_SCALAPACK_LDFLAGS_NO_MPI_NO_OMP="$MKL_INTEL_SCALAPACK_NO_MPI_NO_OMP_BASELINE -Wl,-rpath,$MKL_HOME/lib/intel64"

  - export MKL_INTEL_SCALAPACK_NO_MPI_OMP_BASELINE="-L$MKL_HOME/lib/intel64 -lmkl_intel_lp64 -lmkl_sequential -lmkl_core -lpthread -lm"
  - export MKL_INTEL_SCALAPACK_FCFLAGS_NO_MPI_OMP="$MKL_INTEL_SCALAPACK_NO_MPI_OMP_BASELINE -I$MKL_HOME/include/intel64/lp64"
  - export MKL_INTEL_SCALAPACK_LDFLAGS_NO_MPI_OMP="$MKL_INTEL_SCALAPACK_NO_MPI_OMP_BASELINE -Wl,-rpath,$MKL_HOME/lib/intel64"

  - export MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP_BASELINE="-L$MKL_HOME/lib/intel64 -lmkl_scalapack_lp64 -lmkl_gf_lp64 -lmkl_sequential -lmkl_core -lmkl_blacs_intelmpi_lp64 -lpthread -lm"
  - export MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP="$MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP_BASELINE -I$MKL_HOME/include/intel64/lp64"
  - export MKL_GFORTRAN_SCALAPACK_LDFLAGS_MPI_NO_OMP="$MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP_BASELINE -Wl,-rpath,$MKL_HOME/lib/intel64"

  - export MKL_GFORTRAN_SCALAPACK_MPI_OMP_BASELINE="-L$MKL_HOME/lib/intel64 -lmkl_scalapack_lp64 -lmkl_gf_lp64 -lmkl_sequential -lmkl_core -lmkl_blacs_intelmpi_lp64 -lpthread -lm"
  - export MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP="$MKL_GFORTRAN_SCALAPACK_MPI_OMP_BASELINE -I$MKL_HOME/include/intel64/lp64"
  - export MKL_GFORTRAN_SCALAPACK_LDFLAGS_MPI_OMP="$MKL_GFORTRAN_SCALAPACK_MPI_OMP_BASELINE -Wl,-rpath,$MKL_HOME/lib/intel64"

  - export MKL_GFORTRAN_SCALAPACK_NO_MPI_NO_OMP_BASELINE="-L$MKL_HOME/lib/intel64 -lmkl_gf_lp64 -lmkl_sequential -lmkl_core -lpthread -lm"
  - export MKL_GFORTRAN_SCALAPACK_FCFLAGS_NO_MPI_NO_OMP="$MKL_GFORTRAN_SCALAPACK_NO_MPI_NO_OMP_BASELINE -I$MKL_HOME/include/intel64/lp64"
  - export MKL_GFORTRAN_SCALAPACK_LDFLAGS_NO_MPI_NO_OMP="$MKL_GFORTRAN_SCALAPACK_NO_MPI_NO_OMP_BASELINE -Wl,-rpath,$MKL_HOME/lib/intel64"

  - export MKL_GFORTRAN_SCALAPACK_NO_MPI_OMP_BASELINE="-L$MKL_HOME/lib/intel64 -lmkl_gf_lp64 -lmkl_sequential -lmkl_core -lpthread -lm"
  - export MKL_GFORTRAN_SCALAPACK_FCFLAGS_NO_MPI_OMP="$MKL_GFORTRAN_SCALAPACK_NO_MPI_OMP_BASELINE -I$MKL_HOME/include/intel64/lp64"
  - export MKL_GFORTRAN_SCALAPACK_LDFLAGS_NO_MPI_OMP="$MKL_GFORTRAN_SCALAPACK_NO_MPI_OMP_BASELINE -Wl,-rpath,$MKL_HOME/lib/intel64"

# define two stages, that way coverage only runs after all other
# tests have been done.
stages:
  - test
  - coverage

# jobs for intel/gfortran double precision mpi and no openmp

intel-double-precision-mpi-noomp-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_LDFLAGS_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP"
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

intel-double-precision-mpi-noomp-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_LDFLAGS_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP" --disable-assumed-size
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'


gfortran-double-precision-mpi-noomp-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_LDFLAGS_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP" FC=mpif90
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

gfortran-double-precision-mpi-noomp-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_LDFLAGS_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP"  --disable-assumed-size FC=mpif90
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data


# jobs for intel/gfortran double precision no mpi and no openmp

intel-double-precision-nompi-noomp-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_LDFLAGS_NO_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_NO_MPI_NO_OMP" --with-mpi=no FC=ifort
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

intel-double-precision-nompi-noomp-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_LDFLAGS_NO_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_NO_MPI_NO_OMP" --with-mpi=no  --disable-assumed-size FC=ifort
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

gfortran-double-precision-nompi-noomp-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=gfortran CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_LDFLAGS_NO_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_NO_MPI_NO_OMP" --with-mpi=no
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

gfortran-double-precision-nompi-noomp-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=gfortran CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_LDFLAGS_NO_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_NO_MPI_NO_OMP" --with-mpi=no --disable-assumed-size 
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data


# jobs for intel/gfortran double precision mpi and openmp

intel-double-precision-mpi-openmp-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_LDFLAGS_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

intel-double-precision-mpi-openmp-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_LDFLAGS_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp --disable-assumed-size
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

gfortran-double-precision-mpi-openmp-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure  FC=mpif90 CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_LDFLAGS_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

gfortran-double-precision-mpi-openmp-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure  FC=mpif90 CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_LDFLAGS_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp --disable-assumed-size
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

gfortran-double-precision-mpi-openmp-special-gcov-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure  FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_LDFLAGS_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp
    - make -j 8
    - export OMP_NUM_THREADS=1
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data


# jobs for intel/gfortran double precision no mpi and openmp

intel-double-precision-nompi-openmp-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_LDFLAGS_NO_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_NO_MPI_OMP" --with-mpi=no --enable-openmp FC=ifort
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

intel-double-precision-nompi-openmp-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_LDFLAGS_NO_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_NO_MPI_OMP" --with-mpi=no --enable-openmp  --disable-assumed-size FC=ifort
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

gfortran-double-precision-nompi-openmp-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=gfortran CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_LDFLAGS_NO_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_NO_MPI_OMP" --with-mpi=no --enable-openmp
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

gfortran-double-precision-nompi-openmp-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=gfortran CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_LDFLAGS_NO_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_NO_MPI_OMP" --with-mpi=no --enable-openmp --disable-assumed-size 
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

gfortran-double-precision-nompi-openmp-special-gcov-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=gfortran CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_LDFLAGS_NO_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_NO_MPI_OMP" --with-mpi=no --enable-openmp
    - make -j 8
    - export OMP_NUM_THREADS=1
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data


# jobs for intel/gfortran double precision mpi and no openmp ftimings enabled

intel-double-precision-mpi-noopenmp-ftimings-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_LDFLAGS_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP" --enable-timing
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

gfortran-double-precision-mpi-noopenmp-ftimings-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_LDFLAGS_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP" --enable-timing
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data


# jobs for intel/gfortran double precision no mpi and no openmp ftimings enabled

intel-double-precision-nompi-noopenmp-ftimings-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_LDFLAGS_NO_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_NO_MPI_NO_OMP" --with-mpi=no --enable-timing FC=ifort
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

gfortran-double-precision-nompi-noopenmp-ftimings-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=gfortran CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_LDFLAGS_NO_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_NO_MPI_NO_OMP" --with-mpi=no --enable-timing
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data


# jobs for intel/gfortran double precision no mpi and openmp ftimings enabled

intel-double-precision-nompi-openmp-ftimings-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_LDFLAGS_NO_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_NO_MPI_OMP" --with-mpi=no --enable-timing --enable-openmp FC=ifort
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

gfortran-double-precision-nompi-openmp-ftimings-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=gfortran CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_LDFLAGS_NO_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_NO_MPI_OMP" --with-mpi=no --enable-timing --enable-openmp
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

gfortran-double-precision-nompi-openmp-ftimings-special-gcov-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=gfortran CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_LDFLAGS_NO_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_NO_MPI_OMP" --with-mpi=no --enable-timing --enable-openmp
    - make -j 8
    - export OMP_NUM_THREADS=1
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data


# jobs for intel/gfortran double precision mpi and openmp ftimings enabled

intel-double-precision-mpi-openmp-ftimings-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_LDFLAGS_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp --enable-timing
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

gfortran-double-precision-mpi-openmp-ftimings-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_LDFLAGS_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp --enable-timing
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export OMP_NUM_THREADS=2
    - make check TEST_FLAGS='1500 50 16'

gfortran-double-precision-mpi-openmp-ftimings-special-gcov-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_LDFLAGS_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp --enable-timing
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export OMP_NUM_THREADS=1
    - make check TEST_FLAGS='1500 50 16'
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data


# jobs for intel/gfortran double precision mpi and openmp ftimings and redirect enabled

intel-double-precision-mpi-openmp-ftimings-redirect-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_LDFLAGS_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

gfortran-double-precision-mpi-openmp-ftimings-redirect-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS=" -O3 -mavx" CXXFLAGS=" -O3 -mavx" FCFLAGS=" -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_LDFLAGS_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

gfortran-double-precision-mpi-openmp-ftimings-redirect-special-gcov-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_LDFLAGS_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect
    - make -j 8
    - export OMP_NUM_THREADS=1
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data


# jobs for intel/gfortran double precision mpi and no openmp ftimings and redirect enabled

intel-double-precision-mpi-noopenmp-ftimings-redirect-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_LDFLAGS_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP"  --enable-timing --enable-redirect
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

gfortran-double-precision-mpi-noopenmp-ftimings-redirect-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_LDFLAGS_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP"  --enable-timing --enable-redirect
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data


# jobs for intel/gfortran double precision mpi and openmp ftimings and redirect enabled

#step through kernels: real generic , complex generic
intel-double-precision-mpi-openmp-ftimings-redirect-real-generic-complex-generic-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_LDFLAGS_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

intel-double-precision-mpi-openmp-ftimings-redirect-real-generic-complex-generic-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_LDFLAGS_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only --disable-assumed-size
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-generic-complex-generic-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_LDFLAGS_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-generic-complex-generic-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_LDFLAGS_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only --disable-assumed-size
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-generic-complex-generic-kernel-special-gcov-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_LDFLAGS_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=1
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data


# jobs for intel/gfortran double precision mpi and no openmp ftimings and redirect enabled

#step through kernels: real generic , complex generic

intel-double-precision-mpi-noopenmp-ftimings-redirect-real-generic-complex-generic-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP"  --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

intel-double-precision-mpi-noopenmp-ftimings-redirect-real-generic-complex-generic-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP"  --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only --disable-assumed-size
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'


gfortran-double-precision-mpi-noopenmp-ftimings-redirect-real-generic-complex-generic-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP"  --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

gfortran-double-precision-mpi-noopenmp-ftimings-redirect-real-generic-complex-generic-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP"  --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only --disable-assumed-size
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

# real generic simple, compex generic simple
intel-double-precision-mpi-openmp-ftimings-redirect-real-generic-simple-complex-generic-simple-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

intel-double-precision-mpi-openmp-ftimings-redirect-real-generic-simple-complex-generic-simple-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only --disable-assumed-size
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-generic-simple-complex-generic-simple-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-generic-simple-complex-generic-simple-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only --disable-assumed-size
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-generic-simple-complex-generic-simple-kernel-special-gcov-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=1
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

# real generic simple, complex generic simple

intel-double-precision-mpi-noopenmp-ftimings-redirect-real-generic-simple-complex-generic-simple-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP"   --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'

intel-double-precision-mpi-noopenmp-ftimings-redirect-real-generic-simple-complex-generic-simple-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP"   --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only --disable-assumed-size
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }


gfortran-double-precision-mpi-noopenmp-ftimings-redirect-real-generic-simple-complex-generic-simple-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP"   --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'  || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

gfortran-double-precision-mpi-noopenmp-ftimings-redirect-real-generic-simple-complex-generic-simple-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP"   --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only --disable-assumed-size
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data


# real sse assembly, complex sse assembly

intel-double-precision-mpi-openmp-ftimings-redirect-real-sse_assembly-complex-sse_assembly-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

intel-double-precision-mpi-openmp-ftimings-redirect-real-sse_assembly-complex-sse_assembly-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only --disable-assumed-size
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-sse_assembly-complex-sse_assembly-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-sse_assembly-complex-sse_assembly-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only --disable-assumed-size
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-sse_assembly-complex-sse_assembly-kernel-special-gcov-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=1
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

# real assembly, complex assembly

intel-double-precision-mpi-noopenmp-ftimings-redirect-real-sse_assembly-complex-sse_assembly-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP"  --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

intel-double-precision-mpi-noopenmp-ftimings-redirect-real-sse_assembly-complex-sse_assembly-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP"  --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only --disable-assumed-size
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-noopenmp-ftimings-redirect-real-sse_assembly-complex-sse_assembly-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP"  --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

gfortran-double-precision-mpi-noopenmp-ftimings-redirect-real-sse_assembly-complex-sse_assembly-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP"  --enable-timing --enable-redirect --with-real-generic-kernel-only --with-complex-generic-kernel-only --disable-assumed-size
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

# real sse block2, complex sse block 1

intel-double-precision-mpi-openmp-ftimings-redirect-real-sse_block2-complex-sse_block1-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-sse-block2-kernel-only --with-complex-sse-block1-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

intel-double-precision-mpi-openmp-ftimings-redirect-real-sse_block2-complex-sse_block1-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-sse-block2-kernel-only --with-complex-sse-block1-kernel-only --disable-assumed-size
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-sse_block2-complex-sse_block1-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-sse-block2-kernel-only --with-complex-sse-block1-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-sse_block2-complex-sse_block1-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-sse-block2-kernel-only --with-complex-sse-block1-kernel-only --disable-assumed-size
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-sse_block2-complex-sse_block1-kernel-special-gcov-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-sse-block2-kernel-only --with-complex-sse-block1-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=1
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

# real sse block2, complex sse block1

intel-double-precision-mpi-noopenmp-ftimings-redirect-real-sse_block2-complex-sse_block1-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP"  --enable-timing --enable-redirect --with-real-sse-block2-kernel-only --with-complex-sse-block1-kernel-only
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

intel-double-precision-mpi-noopenmp-ftimings-redirect-real-sse_block2-complex-sse_block1-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP"  --enable-timing --enable-redirect --with-real-sse-block2-kernel-only --with-complex-sse-block1-kernel-only --disable-assumed-size
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-noopenmp-ftimings-redirect-real-sse_block2-complex-sse_block1-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP"  --enable-timing --enable-redirect --with-real-sse-block2-kernel-only --with-complex-sse-block1-kernel-only
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export OMP_NUM_THREADS=1
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

gfortran-double-precision-mpi-noopenmp-ftimings-redirect-real-sse_block2-complex-sse_block1-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP"  --enable-timing --enable-redirect --with-real-sse-block2-kernel-only --with-complex-sse-block1-kernel-only --disable-assumed-size
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16'
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

# real sse block4, complex sse block 2

intel-double-precision-mpi-openmp-ftimings-redirect-real-sse_block4-complex-sse_block2-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-sse-block4-kernel-only --with-complex-sse-block2-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

intel-double-precision-mpi-openmp-ftimings-redirect-real-sse_block4-complex-sse_block2-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-sse-block4-kernel-only --with-complex-sse-block2-kernel-only --disable-assumed-size
    - make -j 8
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-sse_block4-complex-sse_block2-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-sse-block4-kernel-only --with-complex-sse-block2-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-sse_block4-complex-sse_block2-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-sse-block4-kernel-only --with-complex-sse-block2-kernel-only --disable-assumed-size
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-sse_block4-complex-sse_block2-kernel-special-gcov-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-sse-block4-kernel-only --with-complex-sse-block2-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=1
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

# real sse block4, complex sse block 2

intel-double-precision-mpi-noopenmp-ftimings-redirect-real-sse_block4-complex-sse_block2-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP"  --enable-timing --enable-redirect --with-real-sse-block4-kernel-only --with-complex-sse-block2-kernel-only
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

intel-double-precision-mpi-noopenmp-ftimings-redirect-real-sse_block4-complex-sse_block2-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP"  --enable-timing --enable-redirect --with-real-sse-block4-kernel-only --with-complex-sse-block2-kernel-only --disable-assumed-size
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }


gfortran-double-precision-mpi-noopenmp-ftimings-redirect-real-sse_block4-complex-sse_block2-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP"  --enable-timing --enable-redirect --with-real-sse-block4-kernel-only --with-complex-sse-block2-kernel-only
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export OMP_NUM_THREADS=1
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

gfortran-double-precision-mpi-noopenmp-ftimings-redirect-real-sse_block4-complex-sse_block2-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP"  --enable-timing --enable-redirect --with-real-sse-block4-kernel-only --with-complex-sse-block2-kernel-only --disable-assumed-size
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

# real sse block6, complex avx block1
intel-double-precision-mpi-openmp-ftimings-redirect-real-sse_block6-complex-avx_block1-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-sse-block6-kernel-only --with-complex-avx-block1-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

intel-double-precision-mpi-openmp-ftimings-redirect-real-sse_block6-complex-avx_block1-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-sse-block6-kernel-only --with-complex-avx-block1-kernel-only --disable-assumed-size
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-sse_block6-complex-avx_block1-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-sse-block6-kernel-only --with-complex-avx-block1-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-sse_block6-complex-avx_block1-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-sse-block6-kernel-only --with-complex-avx-block1-kernel-only --disable-assumed-size
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-sse_block6-complex-avx_block1-kernel-special-gcov-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-sse-block6-kernel-only --with-complex-avx-block1-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=1
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

# real sse block6, complex avx block1

intel-double-precision-mpi-noopenmp-ftimings-redirect-real-sse_block6-complex-avx_block1-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP"   --enable-timing --enable-redirect --with-real-sse-block6-kernel-only --with-complex-avx-block1-kernel-only
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

intel-double-precision-mpi-noopenmp-ftimings-redirect-real-sse_block6-complex-avx_block1-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP"   --enable-timing --enable-redirect --with-real-sse-block6-kernel-only --with-complex-avx-block1-kernel-only --disable-assumed-size
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-noopenmp-mpi-ftimings-redirect-real-sse_block6-complex-avx_block1-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP"   --enable-timing --enable-redirect --with-real-sse-block6-kernel-only --with-complex-avx-block1-kernel-only
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

gfortran-double-precision-noopenmp-mpi-ftimings-redirect-real-sse_block6-complex-avx_block1-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP"   --enable-timing --enable-redirect --with-real-sse-block6-kernel-only --with-complex-avx-block1-kernel-only --disable-assumed-size
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data


#real avx block2, complex avx block2

intel-double-precision-mpi-openmp-ftimings-redirect-real-avx_block2-complex-avx_block2-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-avx-block2-kernel-only --with-complex-avx-block2-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

intel-double-precision-mpi-openmp-ftimings-redirect-real-avx_block2-complex-avx_block2-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-avx-block2-kernel-only --with-complex-avx-block2-kernel-only --disable-assumed-size
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-avx_block2-complex-avx_block2-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-avx-block2-kernel-only --with-complex-avx-block2-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-avx_block2-complex-avx_block2-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-avx-block2-kernel-only --with-complex-avx-block2-kernel-only --disable-assumed-size
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-avx_block2-complex-avx_block2-kernel-special-gcov-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-avx-block2-kernel-only --with-complex-avx-block2-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=1
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

#real avx block2, complex avx block2

intel-double-precision-mpi-noopenmp-ftimings-redirect-real-avx_block2-complex-avx_block2-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP" --enable-timing --enable-redirect --with-real-avx-block2-kernel-only --with-complex-avx-block2-kernel-only
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

intel-double-precision-mpi-noopenmp-ftimings-redirect-real-avx_block2-complex-avx_block2-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP" --enable-timing --enable-redirect --with-real-avx-block2-kernel-only --with-complex-avx-block2-kernel-only --disable-assumed-size
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }


gfortran-double-precision-mpi-noopenmp-ftimings-redirect-real-avx_block2-complex-avx_block2-kernel:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP" --enable-timing --enable-redirect --with-real-avx-block2-kernel-only --with-complex-avx-block2-kernel-only
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

gfortran-double-precision-mpi-noopenmp-ftimings-redirect-real-avx_block2-complex-avx_block2-assumed-size-kernel:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP" --enable-timing --enable-redirect --with-real-avx-block2-kernel-only --with-complex-avx-block2-kernel-only  --disable-assumed-size
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

#real avx block4, complex avx block2

intel-double-precision-mpi-openmp-ftimings-redirect-real-avx_block4-complex-avx_block2-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-avx-block4-kernel-only --with-complex-avx-block2-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

intel-double-precision-mpi-openmp-ftimings-redirect-real-avx_block4-complex-avx_block2-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-avx-block4-kernel-only --with-complex-avx-block2-kernel-only   --disable-assumed-size
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-avx_block4-complex-avx_block2-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-avx-block4-kernel-only --with-complex-avx-block2-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-avx_block4-complex-avx_block2-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-avx-block4-kernel-only --with-complex-avx-block2-kernel-only --disable-assumed-size
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-avx_block4-complex-avx_block2-kernel-special-gcov-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-avx-block4-kernel-only --with-complex-avx-block2-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=1
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

#real avx block4, complex block2

intel-double-precision-mpi-noopenmp-ftimings-redirect-real-avx_block4-complex-avx_block2-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP" --enable-timing --enable-redirect --with-real-avx-block4-kernel-only --with-complex-avx-block2-kernel-only
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

intel-double-precision-mpi-noopenmp-ftimings-redirect-real-avx_block4-complex-avx_block2-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP" --enable-timing --enable-redirect --with-real-avx-block4-kernel-only --with-complex-avx-block2-kernel-only  --disable-assumed-size
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-noopenmp-ftimings-redirect-real-avx_block4-complex-avx_block2-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP" --enable-timing --enable-redirect --with-real-avx-block4-kernel-only --with-complex-avx-block2-kernel-only
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

gfortran-double-precision-mpi-noopenmp-ftimings-redirect-real-avx-block4-complex-avx_block2-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP" --enable-timing --enable-redirect --with-real-avx-block4-kernel-only --with-complex-avx-block2-kernel-only  --disable-assumed-size
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data


#real avx block6, complex block 2

intel-double-precision-mpi-openmp-ftimings-redirect-real-avx_block6-complex-avx_block2-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-avx-block6-kernel-only --with-complex-avx-block2-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

intel-double-precision-mpi-openmp-ftimings-redirect-real-avx_block6-complex-avx_block2-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-avx-block6-kernel-only --with-complex-avx-block2-kernel-only  --disable-assumed-size
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-avx_block6-complex-avx_block2-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-avx-block6-kernel-only --with-complex-avx-block2-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-avx_block6-complex-avx_block2-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-avx-block6-kernel-only --with-complex-avx-block2-kernel-only  --disable-assumed-size
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-avx_block6-complex-avx_block2-kernel-special-gcov-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-avx-block6-kernel-only --with-complex-avx-block2-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=1
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

#real avx block6 , complex block2

intel-double-precision-mpi-noopenmp-ftimings-redirect-real-avx_block6-complex-avx_block2-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP" --enable-timing --enable-redirect --with-real-avx-block6-kernel-only --with-complex-avx-block2-kernel-only
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

intel-double-precision-mpi-noopenmp-ftimings-redirect-real-avx_block6-complex-avx_block2-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP" --enable-timing --enable-redirect --with-real-avx-block6-kernel-only --with-complex-avx-block2-kernel-only --disable-assumed-size
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-noopenmp-ftimings-redirect-real-avx_block6-complex-avx_block2-kernel-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP" --enable-timing --enable-redirect --with-real-avx-block6-kernel-only --with-complex-avx-block2-kernel-only
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

gfortran-double-precision-mpi-noopenmp-ftimings-redirect-real-avx_block6-complex-avx_block2-kernel-assumed-size-jobs:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP" --enable-timing --enable-redirect --with-real-avx-block6-kernel-only --with-complex-avx-block2-kernel-only --disable-assumed-size
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

#real avx2 block2, complex avx2 block1 (emulated)

intel-double-precision-mpi-openmp-ftimings-redirect-real-avx2_block2-complex-avx2_block1-kernel-jobs:
  tags:
    - emulated
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -march=haswell -mavx2 -mfma" FCFLAGS="-O3 -march=core-avx2" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-avx2-block2-kernel-only --with-complex-avx2-block1-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - /home/elpa/bin/sde-external-7.45.0-2016-05-09-lin/sde -hsw -- make check TEST_FLAGS='150 50 16'

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-avx2_block1-complex-avx2_block1-kernel-jobs:
  tags:
    - emulated
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="-O3 -march=haswell -mavx2 -mfma" FCFLAGS="-O3 -march=haswell -mavx2 -mfma" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-avx2-block2-kernel-only --with-complex-avx2-block1-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - /home/elpa/bin/sde-external-7.45.0-2016-05-09-lin/sde -hsw -- make check TEST_FLAGS='150 50 16'

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-avx2_block2-complex-avx2_block1-kernel-special-gcov-jobs:
  tags:
    - emulated
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -march=haswell -mavx2 -mfma" FCFLAGS="--coverage -O3 -march=haswell -mavx2 -mfma" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-avx2-block2-kernel-only --with-complex-avx2-block1-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=1
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - /home/elpa/bin/sde-external-7.45.0-2016-05-09-lin/sde -hsw -- make check TEST_FLAGS='150 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

intel-double-precision-mpi-noopenmp-ftimings-redirect-real-avx2_block2-complex-avx2_block1-kernel-jobs:
  tags:
    - emulated
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-march=haswell -mavx2 -mfma" FCFLAGS="-O3 -march=core-avx2" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP"  --enable-timing --enable-redirect --with-real-avx2-block2-kernel-only --with-complex-avx2-block1-kernel-only
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - /home/elpa/bin/sde-external-7.45.0-2016-05-09-lin/sde -hsw -- make check TEST_FLAGS='150 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-noopenmp-ftimings-redirect-real-avx2_block2-complex-avx2_block1-kernel-jobs:
  tags:
    - emulated
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -march=haswell -mavx2 -mfma" FCFLAGS="--coverage -O3 -march=haswell -mavx2 -mfma" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP"  --enable-timing --enable-redirect --with-real-avx2-block2-kernel-only --with-complex-avx2-block1-kernel-only
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - /home/elpa/bin/sde-external-7.45.0-2016-05-09-lin/sde -hsw -- make check TEST_FLAGS='150 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

#real avx2 block4, complex avx2 block2 (emulated)

intel-double-precision-mpi-openmp-ftimings-redirect-real-avx2_block4-complex-avx2_block2-kernel-jobs:
  tags:
    - emulated
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -march=haswell -mavx2 -mfma" FCFLAGS="-O3 -march=core-avx2" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-avx2-block4-kernel-only --with-complex-avx2-block2-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - /home/elpa/bin/sde-external-7.45.0-2016-05-09-lin/sde -hsw -- make check TEST_FLAGS='150 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-avx2_block4-complex-avx2_block2-kernel-jobs:
  tags:
    - emulated
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="-O3 -march=haswell -mavx2 -mfma" FCFLAGS="-O3 -march=haswell -mavx2 -mfma" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-avx2-block4-kernel-only --with-complex-avx2-block2-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - /home/elpa/bin/sde-external-7.45.0-2016-05-09-lin/sde -hsw -- make check TEST_FLAGS='150 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-avx2_block4-complex-avx2_block2-kernel-special-gcov-jobs:
  tags:
    - emulated
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -march=haswell -mavx2 -mfma" FCFLAGS="--coverage -O3 -march=haswell -mavx2 -mfma" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-avx2-block4-kernel-only --with-complex-avx2-block2-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=1
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - /home/elpa/bin/sde-external-7.45.0-2016-05-09-lin/sde -hsw -- make check TEST_FLAGS='150 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

#real avx2 block4, complex avx2 block2 (emulated)
intel-double-precision-mpi-noopenmp-ftimings-redirect-real-avx2_block4-complex-avx2_block2-kernel-jobs:
  tags:
    - emulated
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-march=haswell -mavx2 -mfma" FCFLAGS="-O3 -march=core-avx2" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP"  --enable-timing --enable-redirect --with-real-avx2-block4-kernel-only --with-complex-avx2-block2-kernel-only
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - /home/elpa/bin/sde-external-7.45.0-2016-05-09-lin/sde -hsw -- make check TEST_FLAGS='150 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-noopenmp-ftimings-redirect-real-avx2_block4-complex-avx2_block2-kernel-jobs:
  tags:
    - emulated
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -march=haswell -mavx2 -mfma" FCFLAGS="--coverage -O3 -march=haswell -mavx2 -mfma" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP"  --enable-timing --enable-redirect --with-real-avx2-block4-kernel-only --with-complex-avx2-block2-kernel-only
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - /home/elpa/bin/sde-external-7.45.0-2016-05-09-lin/sde -hsw -- make check TEST_FLAGS='150 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

#real avx2 block6, complex avx2 block2 (emulated)

intel-double-precision-mpi-openmp-ftimings-redirect-real-avx2_block6-complex-avx2_block2-kernel-jobs:
  tags:
    - emulated
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -march=haswell -mavx2 -mfma" FCFLAGS="-O3 -march=core-avx2" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-avx2-block6-kernel-only --with-complex-avx2-block2-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - /home/elpa/bin/sde-external-7.45.0-2016-05-09-lin/sde -hsw -- make check TEST_FLAGS='150 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-avx2_block6-complex-avx2_block2-kernel-jobs:
  tags:
    - emulated
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="-O3 -march=haswell -mavx2 -mfma" FCFLAGS="-O3 -march=haswell -mavx2 -mfma" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-avx2-block6-kernel-only --with-complex-avx2-block2-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=2
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - /home/elpa/bin/sde-external-7.45.0-2016-05-09-lin/sde -hsw -- make check TEST_FLAGS='150 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-openmp-ftimings-redirect-real-avx2_block6-complex-avx2_block2-kernel-special-gcov-jobs:
  tags:
    - emulated
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -march=haswell -mavx2 -mfma" FCFLAGS="--coverage -O3 -march=haswell -mavx2 -mfma" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp  --enable-timing --enable-redirect --with-real-avx2-block6-kernel-only --with-complex-avx2-block2-kernel-only
    - make -j 8
    - export OMP_NUM_THREADS=1
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - /home/elpa/bin/sde-external-7.45.0-2016-05-09-lin/sde -hsw -- make check TEST_FLAGS='150 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

#real avx2 block6, complex avx2 block2 (emulated)

intel-double-precision-mpi-noopenmp-ftimings-redirect-real-avx2_block6-complex-avx2_block2-kernel-jobs:
  tags:
    - emulated
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-march=haswell -mavx2 -mfma" FCFLAGS="-O3 -march=core-avx2" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP"  --enable-timing --enable-redirect --with-real-avx2-block6-kernel-only --with-complex-avx2-block2-kernel-only
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - /home/elpa/bin/sde-external-7.45.0-2016-05-09-lin/sde -hsw -- make check TEST_FLAGS='150 50 16' || { cat test-suite.log; exit 1; }

gfortran-double-precision-mpi-noopenmp-ftimings-redirect-real-avx2_block6-complex-avx2_block2-kernel-jobs:
  tags:
    - emulated
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -march=haswell -mavx2 -mfma" FCFLAGS="--coverage -O3 -march=haswell -mavx2 -mfma" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP"  --enable-timing --enable-redirect --with-real-avx2-block6-kernel-only --with-complex-avx2-block2-kernel-only
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - /home/elpa/bin/sde-external-7.45.0-2016-05-09-lin/sde -hsw -- make check TEST_FLAGS='150 50 16'
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data


# testing of kernel settinv via environment

intel-set-kernel-via-environment-variable-mpi-openmp-job:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export REAL_ELPA_KERNEL=REAL_ELPA_KERNEL_GENERIC
    - export COMPLEX_ELPA_KERNEL=COMPLEX_ELPA_KERNEL_GENERIC
    - export OMP_NUM_THREADS=2
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-set-kernel-via-environment-variable-mpi-openmp-job:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export REAL_ELPA_KERNEL=REAL_ELPA_KERNEL_GENERIC
    - export COMPLEX_ELPA_KERNEL=COMPLEX_ELPA_KERNEL_GENERIC
    - export OMP_NUM_THREADS=2
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-set-kernel-via-environment-variable-mpi-openmp-special-gcov-job:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_OMP" --enable-openmp
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export REAL_ELPA_KERNEL=REAL_ELPA_KERNEL_GENERIC
    - export COMPLEX_ELPA_KERNEL=COMPLEX_ELPA_KERNEL_GENERIC
    - export OMP_NUM_THREADS=1
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

intel-set-kernel-via-environment-variable-mpi-noopenmp-job:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP"
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export REAL_ELPA_KERNEL=REAL_ELPA_KERNEL_GENERIC
    - export COMPLEX_ELPA_KERNEL=COMPLEX_ELPA_KERNEL_GENERIC
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-set-kernel-via-environment-variable-mpi-noopenmp-job:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=mpif90 CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP"
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export REAL_ELPA_KERNEL=REAL_ELPA_KERNEL_GENERIC
    - export COMPLEX_ELPA_KERNEL=COMPLEX_ELPA_KERNEL_GENERIC
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

intel-set-kernel-via-environment-variable-nompi-openmp-job:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_NO_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_NO_MPI_OMP" --with-mpi=no --enable-openmp FC=ifort
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export REAL_ELPA_KERNEL=REAL_ELPA_KERNEL_GENERIC
    - export COMPLEX_ELPA_KERNEL=COMPLEX_ELPA_KERNEL_GENERIC
    - export OMP_NUM_THREADS=2
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-set-kernel-via-environment-variable-nompi-openmp-job:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=gfortran CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_NO_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_NO_MPI_OMP" --enable-openmp --with-mpi=no
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export REAL_ELPA_KERNEL=REAL_ELPA_KERNEL_GENERIC
    - export COMPLEX_ELPA_KERNEL=COMPLEX_ELPA_KERNEL_GENERIC
    - export OMP_NUM_THREADS=2
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-set-kernel-via-environment-variable-nompi-openmp-special-gcov-job:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=gfortran CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_NO_MPI_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_NO_MPI_OMP" --enable-openmp --with-mpi=no
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export REAL_ELPA_KERNEL=REAL_ELPA_KERNEL_GENERIC
    - export COMPLEX_ELPA_KERNEL=COMPLEX_ELPA_KERNEL_GENERIC
    - export OMP_NUM_THREADS=1
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

intel-set-kernel-via-environment-variable-nompi-noopenmp-job:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_NO_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_NO_MPI_NO_OMP"  --with-mpi=no FC=ifort
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export REAL_ELPA_KERNEL=REAL_ELPA_KERNEL_GENERIC
    - export COMPLEX_ELPA_KERNEL=COMPLEX_ELPA_KERNEL_GENERIC
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

gfortran-set-kernel-via-environment-variable-nompi-noopenmp-job:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure FC=gfortran CFLAGS="--coverage -O3 -mavx" CXXFLAGS="--coverage -O3 -mavx" FCFLAGS="--coverage -O3 -mavx" SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_NO_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_NO_MPI_NO_OMP" --with-mpi=no
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - export REAL_ELPA_KERNEL=REAL_ELPA_KERNEL_GENERIC
    - export COMPLEX_ELPA_KERNEL=COMPLEX_ELPA_KERNEL_GENERIC
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }
    - ./ci_coverage_collect
  artifacts:
    paths:
      - coverage_data

static-build:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure CFLAGS="-O3 -mavx" CXXFLAGS="-O3 -mavx" FCFLAGS="-O3 -mavx" SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_NO_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_NO_MPI_NO_OMP"  --with-mpi=no FC=ifort --enable-shared=no --enable-static=yes
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - make check TEST_FLAGS='1500 50 16' || { cat test-suite.log; exit 1; }

# test distcheck
distcheck:
  tags:
    - cpu
  script:
    - ./autogen.sh
    - ./configure --with-mpi=no
    # stupid 'make distcheck' leaves behind write-protected files that the stupid gitlab runner cannot remove
    - make distcheck DISTCHECK_CONFIGURE_FLAGS="--with-mpi=no" TEST_FLAGS='1500 50 16' || { chmod u+rwX -R . ; exit 1 ; }


# test test_project
test_project:
  tags:
    - cpu
  script:
    - mkdir build
    - pushd build
    - ../autogen.sh
    - ../configure SCALAPACK_LDFLAGS="$MKL_GFORTRAN_SCALAPACK_LDFLAGS_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_GFORTRAN_SCALAPACK_FCFLAGS_MPI_NO_OMP" FC=mpif90 --prefix=$PWD/installdest
    - make -j 8
    - make install
    - popd
    - mkdir test_project/build
    - pushd test_project/build
    - ../autogen.sh
    - ../configure PKG_CONFIG_PATH=../../build/installdest/lib/pkgconfig FC=mpif90
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - ./test_real
    - make distclean
    - popd
    - pushd build
    - make distclean
    - rm -rf installdest
    - popd

## print coverage results
#total_coverage:
#  stage: coverage
#  tags:
#    - cpu
#  script:
#    - ./ci_coverage_summary
#  artifacts:
#    paths:
#      - coverage_summary

test_project_intel:
  tags:
    - cpu
  script:
    - mkdir build
    - pushd build
    - ../autogen.sh
    - ../configure SCALAPACK_LDFLAGS="$MKL_INTEL_SCALAPACK_LDFLAGS_MPI_NO_OMP" SCALAPACK_FCFLAGS="$MKL_INTEL_SCALAPACK_FCFLAGS_MPI_NO_OMP" FC=mpiifort --prefix=$PWD/installdest
    - make -j 8
    - make install
    - popd
    - mkdir test_project/build
    - pushd test_project/build
    - ../autogen.sh
    - ../configure PKG_CONFIG_PATH=../../build/installdest/lib/pkgconfig FC=mpiifort
    - make -j 8
    - export LD_LIBRARY_PATH=$MKL_HOME/lib/intel64:$LD_LIBRARY_PATH
    - ./test_real
    - make distclean
    - popd
    - pushd build
    - make distclean
    - rm -rf installdest
